<!-- Battle Detail Page - EDK Style -->

<!-- Battle Navigation -->
<nav class="killmail-nav">
    <div class="killmail-nav__container">
        <div class="killmail-nav__primary">
            <div class="killmail-nav__killmail-info">
                <span class="killmail-nav__label">Battle:</span>
                <button
                    class="killmail-nav__killmail-id"
                    onclick="navigator.clipboard.writeText(window.location.href); this.textContent='Copied!'; setTimeout(() => this.textContent='{{system.name}}', 2000);"
                    title="Click to copy battle link"
                >
                    {{system.name}}
                </button>
            </div>
        </div>
    </div>
</nav>

<!-- Battle Info Section -->
<div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin-bottom: 20px;">
    <!-- Left: System Info Box -->
    <div style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); overflow: visible;">
        <div style="padding: 12px 16px; border-bottom: 1px solid var(--color-border-dark);">
            <div style="color: var(--color-text-white); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">
                System Information
            </div>
        </div>
        <div style="padding: 12px 16px; display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                <div style="color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase;">System</div>
                <div style="text-align: right; font-size: 10px;">
                    <b style="color: var(--color-accent-blue-light); font-weight: 600;">{{system.name}}</b>
                    <div style="color: var(--color-text-secondary); font-size: 9px; margin-top: 2px;">
                        <a href="/region/{{system.regionId}}" style="color: var(--color-text-secondary); text-decoration: none;">{{system.region}}</a>
                    </div>
                </div>
            </div>
            <div style="border-top: 1px solid var(--color-border-dark); padding-top: 12px; display: flex; justify-content: space-between; align-items: flex-start;">
                <div style="color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase;">Security</div>
                <div style="font-size: 10px;">
                    <span style="padding: 1px 4px; font-size: 9px; border-radius: var(--radius-sm); {{#if (gte system.security 0.5)}}background: #2F75FE; color: white;{{else}}{{#if (gte system.security 0.1)}}background: #F9A825; color: black;{{else}}background: #D32F2F; color: white;{{/if}}{{/if}}">
                        {{formatNumber system.security}}
                    </span>
                </div>
            </div>
            <div style="border-top: 1px solid var(--color-border-dark); padding-top: 12px; display: flex; justify-content: space-between; align-items: flex-start;">
                <div style="color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase;">Duration</div>
                <div style="font-size: 10px; font-weight: 600;">{{timeWindow.durationMinutes}} minutes</div>
            </div>
        </div>
    </div>

    <!-- Right: Battle Stats Grid -->
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
        <!-- Kills -->
        <div style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); padding: 12px 16px;">
            <div style="color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">Total Kills</div>
            <div style="font-size: 16px; font-weight: 700; color: var(--color-kill-green);">{{stats.killCount}}</div>
        </div>

        <!-- ISK Destroyed -->
        <div style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); padding: 12px 16px;">
            <div style="color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">ISK Destroyed</div>
            <div style="font-size: 14px; font-weight: 700; color: var(--color-accent-gold);">{{formatISK stats.totalIsk}}</div>
        </div>

        <!-- Characters -->
        <div style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); padding: 12px 16px;">
            <div style="color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">Unique Characters</div>
            <div style="font-size: 16px; font-weight: 700; color: var(--color-text-white);">{{stats.uniqueCharacters}}</div>
        </div>

        <!-- Corporations -->
        <div style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); padding: 12px 16px;">
            <div style="color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">Corporations</div>
            <div style="font-size: 16px; font-weight: 700; color: var(--color-accent-blue-light);">{{stats.uniqueCorporations}}</div>
        </div>

        <!-- Alliances -->
        <div style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); padding: 12px 16px;">
            <div style="color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">Alliances</div>
            <div style="font-size: 16px; font-weight: 700; color: var(--color-accent-blue);">{{stats.uniqueAlliances}}</div>
        </div>

        <!-- Time -->
        <div style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); padding: 12px 16px;">
            <div style="color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase; margin-bottom: 8px;">Battle Duration</div>
            <div style="font-size: 14px; font-weight: 600; color: var(--color-text-primary);">{{formatDate timeWindow.startTime}}</div>
            <div style="font-size: 9px; color: var(--color-text-secondary); margin-top: 2px;">to {{formatDate timeWindow.endTime}}</div>
        </div>
    </div>
</div>

<!-- Top 10 Most Valuable Kills Table -->
<div style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); margin-bottom: 20px; overflow: visible;">
    <div style="padding: 12px 16px; border-bottom: 1px solid var(--color-border-dark);">
        <div style="color: var(--color-text-white); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">
            Top 10 Most Valuable Kills
        </div>
    </div>
    <div style="overflow-x: auto;">
        <table class="kb-table" cellspacing="1" style="width: 100%; background: transparent; border: none; border-spacing: 0;">
            <tr class="kb-table-header" style="background: transparent;">
                <td class="kb-table-header" style="text-align: left; padding: 4px 8px; background: transparent; border: none; color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase;">Victim</td>
                <td class="kb-table-header" style="text-align: left; padding: 4px 8px; background: transparent; border: none; color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase;">Ship</td>
                <td class="kb-table-header" style="text-align: left; padding: 4px 8px; background: transparent; border: none; color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase;">Corp/Alliance</td>
                <td class="kb-table-header" style="text-align: center; width: 50px; padding: 4px 8px; background: transparent; border: none; color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase;">Attackers</td>
                <td class="kb-table-header" style="text-align: right; width: 120px; padding: 4px 8px; background: transparent; border: none; color: var(--color-text-secondary); font-size: 9px; font-weight: 600; text-transform: uppercase;">ISK Value</td>
            </tr>
            {{#each topKillmails}}
            <tr class="kb-table-row-{{#if @index}}even{{else}}odd{{/if}}" style="background: transparent; cursor: pointer;" onclick="window.location.href='/killmail/{{killmail_id}}';">
                <td class="kb-table-cell" style="padding: 4px 8px; color: var(--color-accent-blue-light);">
                    {{victim.character.name}}
                </td>
                <td class="kb-table-cell" style="padding: 4px 8px;">{{victim.ship.name}}</td>
                <td class="kb-table-cell" style="padding: 4px 8px; color: var(--color-text-secondary); font-size: 9px;">
                    {{victim.corporation.name}}
                    {{#if victim.alliance.name}}<br><span style="color: var(--color-text-tertiary);">{{victim.alliance.name}}</span>{{/if}}
                </td>
                <td class="kb-table-cell" style="text-align: center; padding: 4px 8px;">{{attackers.length}}</td>
                <td class="kb-table-cell" style="text-align: right; padding: 4px 8px; color: var(--color-kill-green); font-weight: bold;">{{formatISK ship_value}}</td>
            </tr>
            {{/each}}
        </table>
    </div>
</div>

<!-- All Kills (Chronological) - Using killmail-list partial with websocket disabled -->
<div style="background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); margin-top: 20px; overflow: visible;">
    <div style="padding: 12px 16px; border-bottom: 1px solid var(--color-border-dark);">
        <div style="color: var(--color-text-white); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">
            All {{stats.killCount}} Kills (Chronological)
        </div>
    </div>
    <div style="padding: 0;">
        {{> partials/killmail-list killmails=killmails filterConfig=filterConfig}}
    </div>
</div>
