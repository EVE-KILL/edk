<!-- System Detail - EDK Style -->

{{> components/page-header
    title=data.system.name
    breadcrumbs=(array
        (obj label=data.region.name url=(concat "/region/" data.region.regionId))
        (obj label=data.constellation.name url=(concat "/constellation/" data.constellation.constellationId))
        (obj label=data.system.name url=(concat "/system/" data.system.solarSystemId))
    )
    meta=data.systemProperties
}}

<!-- System Stats Header with Integrated Info -->
{{> components/system-stats
    solarSystemId=data.solarSystemId
    name=data.name
    imageUrl=data.imageUrl
    kills=data.kills
    system=data.system
    region=data.region
    constellation=data.constellation
    celestialCounts=data.celestialCounts
}}

<!-- Celestial Objects Section -->
<div style="margin-bottom: 20px; background: var(--color-bg-tertiary); border: 1px solid var(--color-border-dark); border-radius: var(--radius-sm); overflow: hidden;">
    <div style="padding: 12px 16px; border-bottom: 1px solid var(--color-border-dark);">
        <div style="color: var(--color-text-white); font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px;">
            Celestial Objects
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0;">
        <!-- Planets & Moons -->
        {{#if data.celestials}}
        <div style="padding: 12px; border-right: 1px solid var(--color-border-dark);">
            <div style="font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; color: var(--color-text-secondary); margin-bottom: 8px;">
                Planets & Moons
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 4px;">
                {{#each data.celestials}}
                <div style="padding: 4px 6px; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--color-border-dark); border-radius: var(--radius-xs); display: flex; align-items: center; gap: 6px;">
                    <img src="https://images.evetech.net/types/{{this.typeId}}/icon?size=32"
                         alt="{{this.name}}"
                         style="width: 20px; height: 20px; border-radius: 3px; flex-shrink: 0;"
                         loading="lazy" />
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 600; font-size: 9px; color: var(--color-text-primary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            {{this.name}}
                        </div>
                        <div style="color: var(--color-text-secondary); font-size: 7px;">
                            {{this.typeName}}{{#if this.moonCount}} Â· {{this.moonCount}}m{{/if}}
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}

        <!-- Stargates -->
        {{#if data.stargates}}
        <div style="padding: 12px;">
            <div style="font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px; color: var(--color-text-secondary); margin-bottom: 8px;">
                Stargates
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 4px;">
                {{#each data.stargates}}
                <div style="padding: 4px 6px; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--color-border-dark); border-radius: var(--radius-xs); display: flex; align-items: center; gap: 4px;">
                    <div style="flex: 1; min-width: 0;">
                        {{#if this.destinationSystem}}
                        <a href="/system/{{this.destinationSystem.solarSystemId}}"
                           style="color: var(--color-accent-blue-bright); text-decoration: none; font-size: 9px; font-weight: 600; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                            {{this.destinationSystem.name}}
                        </a>
                        <div style="color: var(--color-text-secondary); font-size: 7px;">
                            Sec: {{formatNumber this.destinationSystem.securityStatus decimals=2}}
                        </div>
                        {{else}}
                        <div style="color: var(--color-text-tertiary); font-size: 7px; font-style: italic;">
                            Unknown
                        </div>
                        {{/if}}
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}
    </div>
</div><!-- Most Valuable Kills -->
{{#if data.mostValuableKills}}
{{> partials/mostvaluable mostValuableKills=data.mostValuableKills timeRange="Last 7 Days"}}
{{/if}}

<!-- Recent Activity with Top 10 Sidebar -->
<div style="display: grid; grid-template-columns: minmax(200px, 225px) 1fr; gap: 12px; width: 100%; box-sizing: border-box; margin-bottom: 20px;">
  <!-- Top 10 Sidebar -->
  <aside style="min-width: 0; overflow: hidden;">
    {{#if data.top10Stats}}
      {{> components/top-10-stats stats=data.top10Stats characterTitle="Top Characters" corporationTitle="Top Corporations" allianceTitle="Top Alliances" timeRange="Last 7 Days"}}
    {{/if}}
  </aside>

  <!-- Recent Killmails -->
  <section style="min-width: 0; overflow: hidden;">
      <!-- Filters Above Killmail List -->
      {{#if data.filterDefaults}}
        {{> partials/killlist-filters baseUrl=data.baseUrl filterDefaults=data.filterDefaults pagination=data.pagination filterQueryString=data.filterQueryString}}
      {{/if}}

      {{> partials/killmail-list killmails=data.recentKillmails wsFilter=data.wsFilter}}
  </section>
</div>
