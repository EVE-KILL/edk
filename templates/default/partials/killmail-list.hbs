<div class="kb-kl-list">
    {{#if (length killmails)}}
    <div class="kb-kl-row kb-kl-row--header">
        <div class="kb-kl-col kb-kl-col--ship">Ship type</div>
        <div class="kb-kl-col kb-kl-col--victim">Victim</div>
        <div class="kb-kl-col kb-kl-col--finalblow">Final blow</div>
        <div class="kb-kl-col kb-kl-col--location">Location</div>
        <div class="kb-kl-col kb-kl-col--value">Value</div>
        <div class="kb-kl-col kb-kl-col--time">Time</div>
    </div>

    {{#each killmails}}
    <div class="kb-kl-row{{#if isLoss}} kb-kl-row--loss{{/if}}" data-killmail-id="{{killmail_id}}" onclick="window.location.href='/killmail/{{killmail_id}}';" style="cursor: pointer;">
        <div class="kb-kl-col kb-kl-col--ship">
            <div class="kb-kl-ship">
                {{> partials/eve-image type="ship" id=victim.ship.type_id size=48 alt=victim.ship.name class="kb-kl-ship-icon"}}
                <div class="kb-kl-info kb-kl-info--ship">
                    <div class="kb-kl-info__primary">{{victim.ship.name}}</div>
                    <div class="kb-kl-info__secondary">{{victim.ship.group}}</div>
                </div>
            </div>
        </div>

        <div class="kb-kl-col kb-kl-col--victim">
            <div class="kb-kl-info kb-kl-info--victim">
                <div class="kb-kl-info__primary"{{#if victim.character.id}} data-character-id="{{victim.character.id}}"{{/if}}>
                    {{#if victim.character.id}}
                    <a href="/character/{{victim.character.id}}" class="kb-kl-info__link" onclick="event.stopPropagation();">{{victim.character.name}}</a>
                    {{else}}
                    {{victim.character.name}}
                    {{/if}}
                </div>
                <div class="kb-kl-info__secondary"{{#if victim.corporation.id}} data-corporation-id="{{victim.corporation.id}}"{{/if}}>
                    {{#if victim.corporation.id}}
                    <a href="/corporation/{{victim.corporation.id}}" class="kb-kl-info__link--secondary" onclick="event.stopPropagation();">{{victim.corporation.name}}</a>
                    {{else}}
                    {{victim.corporation.name}}
                    {{/if}}
                </div>
                {{#if victim.alliance}}
                <div class="kb-kl-info__secondary"{{#if victim.alliance.id}} data-alliance-id="{{victim.alliance.id}}"{{/if}}>
                    {{#if victim.alliance.id}}
                    <a href="/alliance/{{victim.alliance.id}}" class="kb-kl-info__link--secondary" onclick="event.stopPropagation();">{{victim.alliance.name}}</a>
                    {{else}}
                    {{victim.alliance.name}}
                    {{/if}}
                </div>
                {{/if}}
            </div>
        </div>

        <div class="kb-kl-col kb-kl-col--finalblow">
            <div class="kb-kl-info kb-kl-info--finalblow">
                {{#if attackers.[0]}}
                <div class="kb-kl-info__primary"{{#if attackers.[0].character.id}} data-character-id="{{attackers.[0].character.id}}"{{/if}}>
                    {{#if attackers.[0].character.id}}
                    <a href="/character/{{attackers.[0].character.id}}" class="kb-kl-info__link" onclick="event.stopPropagation();">{{attackers.[0].character.name}}</a>
                    {{else}}
                    {{attackers.[0].character.name}}
                    {{/if}}
                </div>
                <div class="kb-kl-info__secondary"{{#if attackers.[0].corporation.id}} data-corporation-id="{{attackers.[0].corporation.id}}"{{/if}}>
                    {{#if attackers.[0].corporation.id}}
                    <a href="/corporation/{{attackers.[0].corporation.id}}" class="kb-kl-info__link--secondary" onclick="event.stopPropagation();">{{attackers.[0].corporation.name}}</a>
                    {{else}}
                    {{attackers.[0].corporation.name}}
                    {{/if}}
                </div>
                {{#if attackers.[0].alliance}}
                <div class="kb-kl-info__secondary"{{#if attackers.[0].alliance.id}} data-alliance-id="{{attackers.[0].alliance.id}}"{{/if}}>
                    {{#if attackers.[0].alliance.id}}
                    <a href="/alliance/{{attackers.[0].alliance.id}}" class="kb-kl-info__link--secondary" onclick="event.stopPropagation();">{{attackers.[0].alliance.name}}</a>
                    {{else}}
                    {{attackers.[0].alliance.name}}
                    {{/if}}
                </div>
                {{/if}}
                {{else}}
                <div class="kb-kl-value--unknown">Unknown</div>
                {{/if}}
            </div>
        </div>

        <div class="kb-kl-col kb-kl-col--location">
            <div class="kb-kl-info">
                <div class="kb-kl-info__primary">{{solar_system.name}}</div>
                <div class="kb-kl-info__secondary">{{solar_system.region}}</div>
            </div>
        </div>

        <div class="kb-kl-col kb-kl-col--value">
            <div class="kb-kl-info kb-kl-info--value">
                {{#if total_value}}
                    <div class="kb-kl-value" data-total-value="{{killmail_id}}">{{abbreviateISK total_value}}</div>
                {{else}}
                    <div class="kb-kl-value--unknown" data-total-value="{{killmail_id}}">N/A</div>
                {{/if}}
                {{#if attacker_count}}
                    <div class="kb-kl-info__secondary kb-kl-attackers-count">({{attacker_count}})</div>
                {{/if}}
            </div>
        </div>

        <div class="kb-kl-col kb-kl-col--time">
            <span class="kb-kl-time">{{killmail_time}}</span>
        </div>
    </div>
    {{/each}}
    {{else}}
    <div class="kb-kl-row kb-kl-row--empty">
        <div style="text-align: center; padding: 20px;">No killmails found.</div>
    </div>
    {{/if}}
</div>

<style>
.kb-kl-list {
  display: flex;
  flex-direction: column;
  gap: 0;
  background: var(--color-bg-tertiary);
  border: 1px solid var(--color-border-dark);
  border-radius: 4px;
  overflow: hidden;
  width: 100%;
  box-sizing: border-box;
}

.kb-kl-row {
  display: flex;
  flex-direction: row;
  gap: 1px;
  background-color: rgba(0, 0, 0, 0.2);
  border-bottom: 1px solid var(--color-border-dark);
  transition: background-color 0.2s ease;
}

.kb-kl-row:last-child {
  border-bottom: none;
}

.kb-kl-row:hover {
  background-color: rgba(74, 158, 255, 0.15);
}

.kb-kl-row--loss {
  background-color: rgba(139, 54, 54, 0.25) !important;
}

.kb-kl-row--loss:hover {
  background-color: rgba(139, 54, 54, 0.35) !important;
}

.kb-kl-row--header {
  background-color: transparent;
  color: var(--color-text-white);
  font-weight: 600;
  border-bottom: 1px solid var(--color-border-dark);
  position: sticky;
  top: 0;
  z-index: 10;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 11px;
}

.kb-kl-row--header .kb-kl-col {
  padding: 12px 16px;
  color: var(--color-text-secondary);
  font-size: 10px;
  font-weight: 600;
}

.kb-kl-row--empty {
  justify-content: center;
  align-items: center;
  min-height: 60px;
  color: var(--color-text-secondary);
  background: transparent !important;
  border: none !important;
}

.kb-kl-col {
  display: flex;
  align-items: center;
  padding: 10px 16px;
  min-width: 0;
  overflow: hidden;
}

/* Column proportions for desktop - with flex grow to prevent cutoff */
.kb-kl-col--ship {
  flex: 1 1 22%;
  gap: 8px;
  min-width: 150px;
}

.kb-kl-col--victim {
  flex: 1 1 22%;
  min-width: 130px;
}

.kb-kl-col--finalblow {
  flex: 1 1 18%;
  min-width: 120px;
}

.kb-kl-col--location {
  flex: 1 1 13%;
  min-width: 100px;
}

.kb-kl-col--value {
  flex: 1 1 15%;
  justify-content: flex-end;
  min-width: 90px;
}

.kb-kl-col--time {
  flex: 0 0 10%;
  justify-content: center;
  min-width: 80px;
}

/* Ship container with image and info */
.kb-kl-ship {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
  min-width: 0;
}

.kb-kl-ship-icon {
  flex-shrink: 0;
  width: 48px;
  height: 48px;
  border: 0;
  display: block;
  border-radius: 2px;
}

.kb-kl-info {
  line-height: 1.3;
  overflow: hidden;
  flex: 1;
  min-width: 0;
}

.kb-kl-info--ship {
  min-width: 0;
}

.kb-kl-info--victim {
  min-width: 0;
}

.kb-kl-info--finalblow {
  min-width: 0;
}

.kb-kl-info--value {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  min-width: 0;
}

.kb-kl-info__primary {
  font-weight: 600;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 11px;
  color: var(--color-text-white);
}

.kb-kl-info__secondary {
  color: var(--color-text-secondary);
  font-size: 9px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.kb-kl-info__link {
  color: #4a9eff;
  text-decoration: none;
  transition: color 0.2s ease;
}

.kb-kl-info__link:hover {
  color: #6ab3ff;
  text-decoration: underline;
}

.kb-kl-info__link--secondary {
  color: var(--color-text-secondary);
  text-decoration: none;
  transition: color 0.2s ease;
}

.kb-kl-info__link--secondary:hover {
  color: #4a9eff;
  text-decoration: underline;
}

.kb-kl-value {
  color: #4ade80;
  font-weight: 700;
  font-size: 11px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.kb-kl-value--unknown {
  color: var(--color-text-secondary);
  font-size: 9px;
}

.kb-kl-time {
  font-size: 9px;
  color: var(--color-text-secondary);
}

.kb-kl-attackers-count {
  text-align: right;
}

/* Responsive: collapse to single column on mobile */
@media (max-width: 1024px) {
  .kb-kl-col--ship { flex: 0 0 25%; }
  .kb-kl-col--victim { flex: 0 0 25%; }
  .kb-kl-col--finalblow { flex: 0 0 20%; }
  .kb-kl-col--location { flex: 0 0 15%; }
  .kb-kl-col--value { flex: 0 0 10%; }
  .kb-kl-col--time { flex: 0 0 5%; }
}

@media (max-width: 768px) {
  .kb-kl-row {
    flex-wrap: wrap;
    gap: 0;
  }

  .kb-kl-col {
    border-right: 1px solid var(--color-border-dark);
  }

  .kb-kl-col--ship { flex: 0 0 100%; border-right: none; }
  .kb-kl-col--victim { flex: 0 0 50%; }
  .kb-kl-col--finalblow { flex: 0 0 50%; border-left: 1px solid var(--color-border-dark); }
  .kb-kl-col--location { flex: 0 0 50%; border-right: none; }
  .kb-kl-col--value { flex: 0 0 50%; }
  .kb-kl-col--time { flex: 0 0 100%; border-left: none; }
}
</style>
